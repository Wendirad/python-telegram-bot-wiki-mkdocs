<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Exception Handling - python telegram bot wiki</title>
    <link href="../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../js/bootstrap-3.3.7.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Other exceptions", url: "#_top", children: [
          ]},
        ];

    </script>
    <script src="../js/base.js"></script>
      <script src="../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Performance-Optimizations/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Performance-Optimizations/" class="btn btn-xs btn-link">
        Performance Optimizations
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Code-snippets/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Code-snippets/" class="btn btn-xs btn-link">
        Code snippets
      </a>
    </div>
    
  </div>

    

    <p>In <code>python-telegram-bot</code>, all Telegram-related errors are encapsulated in the <code>TelegramError</code> exception class and its subclasses, located in <a href="https://python-telegram-bot.readthedocs.io/en/stable/telegram.error.html"><code>telegram.error</code></a> module.</p>
<p>Any error, including <code>TelegramError</code>, that is raised in one of your handlers (or while calling <code>get_updates</code> in the <code>Updater</code>), is forwarded to all registered error handlers, so you can react to them. You can register an error handler by calling <code>Dispatcher.add_error_handler(callback)</code>, where <code>callback</code> is a function that takes the <code>update</code> and <code>context</code>. <code>update</code> will be the update that caused the error and <code>context.error</code> the error that was raised.</p>
<p>Example: You're trying to send a message, but the user blocked the bot. An <code>Unauthorized</code> exception, a subclass of <code>TelegramError</code>, will be raised and delivered to your error handler, so you can delete it from your conversation list, if you keep one.</p>
<p><strong>Note:</strong> The error handler might be only your last resort - of course you can also handle Exceptions as they occur. Only uncaught exceptions are forwarded to the error handler.</p>
<p>Here is an example code that uses all current subclasses of <code>TelegramError</code>:</p>
<pre><code class="python">from telegram.error import (TelegramError, Unauthorized, BadRequest, 
                            TimedOut, ChatMigrated, NetworkError)

def error_callback(update, context):
    try:
        raise context.error
    except Unauthorized:
        # remove update.message.chat_id from conversation list
    except BadRequest:
        # handle malformed requests - read more below!
    except TimedOut:
        # handle slow connection problems
    except NetworkError:
        # handle other connection problems
    except ChatMigrated as e:
        # the chat_id of a group has changed, use e.new_chat_id instead
    except TelegramError:
        # handle all other telegram related errors

dispatcher.add_error_handler(error_callback)
</code></pre>

<p>Here are some examples that would cause a <code>BadRequest</code> error to be raised:</p>
<pre><code class="python">&gt;&gt;&gt; bot.leave_chat(chat_id=&lt;invalid chat id&gt;)
[...]
telegram.error.BadRequest: Chat not found

&gt;&gt;&gt; bot.answer_callback_query(&lt;invalid query id&gt;)
[...]
telegram.error.BadRequest: Query_id_invalid

&gt;&gt;&gt; bot.get_file(&lt;invalid file id&gt;)
[...]
telegram.error.BadRequest: Invalid file id

&gt;&gt;&gt; bot.edit_message_text(chat_id, &quot;sample old message&quot;)
[...]
telegram.error.BadRequest: Message is not modified

&gt;&gt;&gt; bot.send_message(chat_id, 'a'*40960)
[...]
telegram.error.BadRequest: Message is too long
</code></pre>

<p>For the last one you can check if your message is too long by comparing with <code>telegram.constants.MAX_MESSAGE_LENGTH</code>. There is something similar for captions: <code>telegram.constants.MAX_CAPTION_LENGTH</code>.</p>
<h3 id="other-exceptions">Other exceptions</h3>
<p>If a handler raises an uncaught exception that is no <code>TelegramError</code> (e.g. an <code>IndexError</code>), the exception will be caught and logged by the <code>Dispatcher</code>, so that the bot does not crash but you still have an indication of it and can address the issue. To take advantage of this, it is helpful to set up the <code>logging</code> module.</p>
<p>Example code to set up the <code>logging</code> module:</p>
<pre><code class="python">logging.basicConfig(
        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
        level=logging.INFO)
</code></pre>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../Performance-Optimizations/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../Performance-Optimizations/" class="btn btn-xs btn-link">
        Performance Optimizations
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../Code-snippets/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Code-snippets/" class="btn btn-xs btn-link">
        Code snippets
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="">Windmill Dark</a> theme by None (noraj).</p>
</footer>

</body>
</html>